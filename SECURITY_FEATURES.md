# 実装済みセキュリティ機能

## 1. パスワードポリシー
- **複雑性要件**
  - 最小8文字
  - 大文字・小文字・数字・特殊文字（@$!%*#?&）を各1文字以上含む
  - 同じ文字の3文字以上の連続使用不可
  - ユーザー名を含まない
  - よく使われるパスワードの禁止

- **パスワード履歴管理**
  - 過去5回分のパスワードは再利用不可
  - パスワード変更時に自動的に履歴を保存

## 2. ペッパーとソルトによる強化
- **BCrypt + ペッパー**
  - BCryptが自動的にソルトを生成・管理
  - アプリケーション側でペッパーを追加（SHA-256）
  - ペッパーは環境変数で管理

## 3. アカウントロック機能
- **自動ロック**
  - 5回連続でログイン失敗するとアカウントロック
  - ロック期間：30分（自動解除）
  
- **ロック時の動作**
  - ロックされたアカウントはログイン不可
  - 専用のエラーメッセージを表示

## 4. 監査ログシステム
- **記録されるイベント**
  - ログイン成功・失敗
  - アカウントロック・解除
  - ユーザー登録
  - パスワード変更
  - ログアウト
  - 不審なアクティビティ

- **記録される情報**
  - イベントタイプ、ユーザー名
  - IPアドレス、ユーザーエージェント
  - 成功/失敗フラグ、詳細情報
  - タイムスタンプ

- **不審なアクティビティ検出**
  - 同一IPから1時間以内に10回以上の失敗で警告

## 5. UIの改善
- **Bootstrap 5の導入**
  - レスポンシブデザイン
  - 見やすいエラーメッセージ表示
  - パスワード要件の明示

## 今後の実装予定

### 優先度：中
1. **多要素認証（TOTP）**
   - Google Authenticatorとの連携
   - QRコード生成
   - バックアップコード

2. **ワンタイムパスワード（メール）**
   - メール送信機能
   - 有効期限管理
   - 再送信制限

### 優先度：低
3. **リスクベース認証**
   - 新しいデバイス/場所からのログイン検出
   - デバイスフィンガープリント
   - 異常パターンの検出

4. **シングルサインオン（SSO）**
   - OAuth 2.0実装
   - OpenID Connect対応
   - 外部IDプロバイダー連携

## セキュリティベストプラクティス

### 環境変数の設定（必須）
```bash
export SECURITY_PEPPER="your-secret-pepper-here"
export JWT_SECRET="your-jwt-secret-here"
```

### データベースの本番化
現在はH2インメモリDBを使用していますが、本番環境では以下を推奨：
- PostgreSQLまたはMySQL
- 適切なバックアップ戦略
- データベース暗号化

### HTTPS化
- SSL/TLS証明書の導入
- HTTPからHTTPSへの自動リダイレクト
- HSTSヘッダーの設定

### セキュリティヘッダー
以下のヘッダーを設定することを推奨：
- Content-Security-Policy
- X-Frame-Options
- X-Content-Type-Options
- X-XSS-Protection

### 定期的なセキュリティ監査
- 監査ログの定期的なレビュー
- 脆弱性スキャンの実施
- ペネトレーションテスト