# プロジェクト計画 - LoginDemoセキュリティ強化

## プロジェクト概要
Spring Bootを使用したログイン機能のデモアプリケーションを、本番環境で使用可能なレベルまでセキュリティを強化する。

## 現状の分析
### 実装済み機能
- 基本的なユーザー登録・ログイン機能
- BCryptによるパスワードハッシュ化
- Spring Securityによるセッション管理
- CSRF保護

### 課題
- パスワードの複雑性チェックなし
- アカウントロック機能なし
- 監査ログなし
- 多要素認証なし
- パスワードリセット機能なし

## セキュリティ強化計画

### フェーズ1: 基本的なセキュリティ強化
1. **パスワードポリシーの実装**
   - 最小文字数、大文字・小文字・数字・特殊文字の組み合わせ
   - パスワード履歴管理
   - 定期的なパスワード変更要求

2. **ペッパーとソルトの実装**
   - BCrypt（既存のソルト）に加えてペッパーを追加
   - ペッパーは環境変数で管理

3. **アカウントロック機能**
   - 連続ログイン失敗時のアカウントロック
   - 時間経過による自動解除
   - 管理者による手動解除

4. **監査ログ**
   - ログイン成功・失敗の記録
   - パスワード変更の記録
   - 重要な操作の記録

### フェーズ2: 高度な認証機能
1. **多要素認証（MFA）**
   - TOTP（Time-based One-Time Password）の実装
   - QRコード生成
   - バックアップコード

2. **ワンタイムパスワード（OTP）**
   - メール/SMS送信
   - 有効期限管理

3. **リスクベース認証**
   - IPアドレスチェック
   - デバイスフィンガープリント
   - 異常なログインパターンの検出

### フェーズ3: エンタープライズ機能
1. **シングルサインオン（SSO）**
   - OAuth 2.0 / OpenID Connect
   - SAML 2.0
   - 社内IDプロバイダーとの連携

2. **セッション管理の強化**
   - 同時ログイン制限
   - セッションタイムアウト
   - Remember Me機能（セキュア実装）

3. **パスワードリセット**
   - セキュアなトークン生成
   - メール送信
   - 有効期限管理

### フェーズ4: 運用・保守機能
1. **CI/CDパイプライン**
   - 自動テスト
   - セキュリティスキャン
   - 自動デプロイ

2. **モニタリング**
   - ログ収集・分析
   - アラート設定
   - ダッシュボード

3. **データベース移行**
   - H2からPostgreSQL/MySQLへ
   - マイグレーションツール（Flyway/Liquibase）

## 技術スタック
### 現在
- Spring Boot 3.5.0
- Spring Security
- Thymeleaf
- H2 Database
- BCrypt

### 追加予定
- Spring Boot Starter Mail（メール送信）
- Google Authenticator（TOTP）
- Redis（セッション管理）
- PostgreSQL/MySQL（本番DB）
- Flyway（DBマイグレーション）
- Prometheus + Grafana（モニタリング）
- ELK Stack（ログ管理）

## 実装優先順位
1. パスワードポリシー
2. ペッパー実装
3. アカウントロック
4. 監査ログ
5. MFA（TOTP）
6. パスワードリセット
7. リスクベース認証
8. SSO
9. CI/CDパイプライン
10. モニタリング

## 成功指標
- OWASP Top 10の脆弱性に対応
- ペネトレーションテストの合格
- 99.9%の可用性
- 平均認証時間 < 2秒
- セキュリティインシデント0件